2025-10-03 14:19:26.791 -05:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "type" = 'table' AND "rootpage" IS NOT NULL;
2025-10-03 14:19:26.993 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "type" = 'table' AND "rootpage" IS NOT NULL;
2025-10-03 14:19:27.240 -05:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Roles" AS "r")
2025-10-03 14:19:27.259 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Usuarios" AS "u")
2025-10-03 14:19:27.268 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "UsuarioRoles" AS "u")
2025-10-03 14:19:27.284 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Productos" AS "p")
2025-10-03 14:19:27.294 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Pedidos" AS "p")
2025-10-03 14:19:27.307 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "PedidoItems" AS "p")
2025-10-03 14:19:27.385 -05:00 [INF] User profile is available. Using 'C:\Users\Usuario\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-03 14:19:27.472 -05:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert.
2025-10-03 14:19:27.501 -05:00 [INF] Now listening on: https://localhost:54254
2025-10-03 14:19:27.504 -05:00 [INF] Now listening on: http://localhost:54255
2025-10-03 14:19:27.511 -05:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-03 14:19:27.515 -05:00 [INF] Hosting environment: Development
2025-10-03 14:19:27.517 -05:00 [INF] Content root path: C:\Users\Usuario\Documents\Prueba Dito\src\BackendAPI
2025-10-03 14:19:33.002 -05:00 [INF] Request starting HTTP/1.1 POST https://localhost:54254/api/auth/login - application/json 75
2025-10-03 14:19:33.173 -05:00 [INF] Executing endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:19:33.193 -05:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[BackendAPI.Domain.DTOs.AuthResponseDto]] Login(BackendAPI.Domain.DTOs.LoginDto) on controller BackendAPI.Controllers.AuthController (BackendAPI).
2025-10-03 14:19:33.400 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 24)], CommandType='"Text"', CommandTimeout='30']
SELECT "u"."Id", "u"."Activo", "u"."Apellido", "u"."Direccion", "u"."Email", "u"."FechaCreacion", "u"."FechaModificacion", "u"."FechaNacimiento", "u"."Nombre", "u"."NumeroDocumento", "u"."PasswordHash", "u"."RefreshToken", "u"."RefreshTokenExpiryTime", "u"."Telefono", "u"."TipoDocumento"
FROM "Usuarios" AS "u"
WHERE "u"."Email" = @__email_0
LIMIT 1
2025-10-03 14:19:33.409 -05:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-03 14:19:33.420 -05:00 [INF] Executed action BackendAPI.Controllers.AuthController.Login (BackendAPI) in 216.6344ms
2025-10-03 14:19:33.430 -05:00 [INF] Executed endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:19:33.443 -05:00 [INF] Request finished HTTP/1.1 POST https://localhost:54254/api/auth/login - 401 null application/json; charset=utf-8 438.5556ms
2025-10-03 14:19:35.481 -05:00 [INF] Request starting HTTP/1.1 POST https://localhost:54254/api/auth/login - application/json 75
2025-10-03 14:19:35.491 -05:00 [INF] Executing endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:19:35.496 -05:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[BackendAPI.Domain.DTOs.AuthResponseDto]] Login(BackendAPI.Domain.DTOs.LoginDto) on controller BackendAPI.Controllers.AuthController (BackendAPI).
2025-10-03 14:19:35.703 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[@__email_0='?' (Size = 24)], CommandType='"Text"', CommandTimeout='30']
SELECT "u"."Id", "u"."Activo", "u"."Apellido", "u"."Direccion", "u"."Email", "u"."FechaCreacion", "u"."FechaModificacion", "u"."FechaNacimiento", "u"."Nombre", "u"."NumeroDocumento", "u"."PasswordHash", "u"."RefreshToken", "u"."RefreshTokenExpiryTime", "u"."Telefono", "u"."TipoDocumento"
FROM "Usuarios" AS "u"
WHERE "u"."Email" = @__email_0
LIMIT 1
2025-10-03 14:19:35.725 -05:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-03 14:19:35.744 -05:00 [INF] Executed action BackendAPI.Controllers.AuthController.Login (BackendAPI) in 242.8084ms
2025-10-03 14:19:35.753 -05:00 [INF] Executed endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:19:35.759 -05:00 [INF] Request finished HTTP/1.1 POST https://localhost:54254/api/auth/login - 401 null application/json; charset=utf-8 277.3896ms
2025-10-03 14:20:25.824 -05:00 [INF] Request starting HTTP/1.1 POST https://localhost:54254/api/auth/login - multipart/form-data; boundary=--------------------------570922582217766517017558 300
2025-10-03 14:20:25.852 -05:00 [INF] Executing endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:20:25.876 -05:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[BackendAPI.Domain.DTOs.AuthResponseDto]] Login(BackendAPI.Domain.DTOs.LoginDto) on controller BackendAPI.Controllers.AuthController (BackendAPI).
2025-10-03 14:20:25.984 -05:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-10-03 14:20:26.046 -05:00 [INF] Executed action BackendAPI.Controllers.AuthController.Login (BackendAPI) in 138.1871ms
2025-10-03 14:20:26.049 -05:00 [INF] Executed endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:20:26.051 -05:00 [INF] Request finished HTTP/1.1 POST https://localhost:54254/api/auth/login - 415 null application/problem+json; charset=utf-8 227.1574ms
2025-10-03 14:20:40.979 -05:00 [INF] Request starting HTTP/1.1 POST https://localhost:54254/api/auth/login - application/json 75
2025-10-03 14:20:40.988 -05:00 [INF] Executing endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:20:40.991 -05:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[BackendAPI.Domain.DTOs.AuthResponseDto]] Login(BackendAPI.Domain.DTOs.LoginDto) on controller BackendAPI.Controllers.AuthController (BackendAPI).
2025-10-03 14:20:40.998 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[@__email_0='?' (Size = 24)], CommandType='"Text"', CommandTimeout='30']
SELECT "u"."Id", "u"."Activo", "u"."Apellido", "u"."Direccion", "u"."Email", "u"."FechaCreacion", "u"."FechaModificacion", "u"."FechaNacimiento", "u"."Nombre", "u"."NumeroDocumento", "u"."PasswordHash", "u"."RefreshToken", "u"."RefreshTokenExpiryTime", "u"."Telefono", "u"."TipoDocumento"
FROM "Usuarios" AS "u"
WHERE "u"."Email" = @__email_0
LIMIT 1
2025-10-03 14:20:41.003 -05:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-03 14:20:41.007 -05:00 [INF] Executed action BackendAPI.Controllers.AuthController.Login (BackendAPI) in 12.5092ms
2025-10-03 14:20:41.012 -05:00 [INF] Executed endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:20:41.015 -05:00 [INF] Request finished HTTP/1.1 POST https://localhost:54254/api/auth/login - 401 null application/json; charset=utf-8 35.5409ms
2025-10-03 14:21:05.323 -05:00 [INF] Request starting HTTP/1.1 POST https://localhost:54254/api/auth/login - application/json 75
2025-10-03 14:21:05.340 -05:00 [INF] Executing endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:21:05.345 -05:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[BackendAPI.Domain.DTOs.AuthResponseDto]] Login(BackendAPI.Domain.DTOs.LoginDto) on controller BackendAPI.Controllers.AuthController (BackendAPI).
2025-10-03 14:21:05.361 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[@__email_0='?' (Size = 24)], CommandType='"Text"', CommandTimeout='30']
SELECT "u"."Id", "u"."Activo", "u"."Apellido", "u"."Direccion", "u"."Email", "u"."FechaCreacion", "u"."FechaModificacion", "u"."FechaNacimiento", "u"."Nombre", "u"."NumeroDocumento", "u"."PasswordHash", "u"."RefreshToken", "u"."RefreshTokenExpiryTime", "u"."Telefono", "u"."TipoDocumento"
FROM "Usuarios" AS "u"
WHERE "u"."Email" = @__email_0
LIMIT 1
2025-10-03 14:21:05.382 -05:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-03 14:21:05.394 -05:00 [INF] Executed action BackendAPI.Controllers.AuthController.Login (BackendAPI) in 37.4027ms
2025-10-03 14:21:05.408 -05:00 [INF] Executed endpoint 'BackendAPI.Controllers.AuthController.Login (BackendAPI)'
2025-10-03 14:21:05.418 -05:00 [INF] Request finished HTTP/1.1 POST https://localhost:54254/api/auth/login - 401 null application/json; charset=utf-8 94.7558ms
2025-10-03 14:22:46.537 -05:00 [INF] Application is shutting down...
2025-10-03 14:27:30.742 -05:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "type" = 'table' AND "rootpage" IS NOT NULL;
2025-10-03 14:27:30.818 -05:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "type" = 'table' AND "rootpage" IS NOT NULL;
2025-10-03 14:27:30.995 -05:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "r"."Id", "r"."Activo", "r"."Descripcion", "r"."FechaCreacion", "r"."FechaModificacion", "r"."Nombre"
FROM "Roles" AS "r"
2025-10-03 14:27:31.443 -05:00 [ERR] Failed executing DbCommand (28ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "Roles"
WHERE "Id" = @p0
RETURNING 1;
2025-10-03 14:27:31.518 -05:00 [ERR] An exception occurred in the database while saving changes for context type 'BackendAPI.Infrastructure.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'FOREIGN KEY constraint failed'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'FOREIGN KEY constraint failed'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
